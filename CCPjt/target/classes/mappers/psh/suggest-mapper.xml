<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  	
<mapper namespace ="suggest_board">

<!-- 글쓰기 -->
<insert id="insert">
	insert into complaint_board(b_serialno, b_no, b_addinfo, b_detailinfo, b_title, b_writer, b_content)
	values (seq_suggest_serialno.nextval, seq_suggest.nextval, #{b_addinfo}, #{b_detailinfo}, #{b_title}, #{b_writer}, #{b_content})
</insert>

<!-- 글목록 -->
<select id="suggest_list" resultType="complaint_BoardVo">
<!--   	select * from complaint_board -->
<!--  	order by b_no desc  -->
	select * from (select rownum rnum, a.* from 
		(select * from complaint_board
		<include refid="search"></include> 
			order by b_no desc) a)
		where rnum &gt;= #{startRow} and rnum &lt;= #{endRow}
</select>

<!-- 글읽기 -->
<select id="suggest_read" resultType="complaint_BoardVo">
	select * from complaint_board
	where b_no = #{b_no}
</select>

<!-- 글 수정 -->
<update id="suggest_update">
	update complaint_board set
		b_title = #{b_title},
		b_content = #{b_content},
		b_writer = #{b_writer}
	where b_no = #{b_no}
</update>

<!-- 글 삭제 -->
<delete id="suggest_delete">
	delete from complaint_board
	where b_no = #{b_no}
</delete>
<!-- 글 갯수 -->
<select id="listCount" resultType="int">
	select count(*) from complaint_board
	<include refid="search"></include>
</select>

	<!-- 댓글 갯수 갱신 -->
<!-- 	<update id="updateReplycnt"> -->
<!-- 		update complaint_board set -->
<!-- 			replycnt = (select count(*) -->
<!-- 						from testreply -->
<!-- 						where b_no = #{b_no}) -->
<!-- 		where b_no = #{b_no} -->
<!-- 	</update> -->
	
<!-- 첨부파일 경로 추가 -->
<!-- <insert id="attach"> -->

<!-- </insert> -->
<sql id="search">
		<if test="searchType != null">
      		<if test="searchType == 'b_title'">
      			where b_title like '%' || #{keyword} || '%'
      		</if>
      		<if test="searchType == 'b_content'">
      			where b_content like '%' || #{keyword} || '%'
      		</if>
      		<if test="searchType == 'b_writer'">
      			where b_writer like '%' || #{keyword} || '%'
      		</if>
      		
         </if>
	</sql>

</mapper>  	